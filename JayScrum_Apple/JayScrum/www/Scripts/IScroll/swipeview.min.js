/*!
 * SwipeView v0.10 ~ Copyright (c) 2011 Matteo Spinelli, http://cubiq.org
 * Released under MIT license, http://cubiq.org/license
 */
var SwipeView=(function(){var e="ontouchstart" in window,d="onorientationchange" in window?"orientationchange":"resize",a=e?"touchstart":"mousedown",f=e?"touchmove":"mousemove",g=e?"touchend":"mouseup",b=e?"touchcancel":"mouseup",c=function(m,j){var k,n,l,h;this.wrapper=typeof m=="string"?document.querySelector(m):m;this.options={text:null,numberOfPages:3,snapThreshold:null,hastyPageFlip:true,loop:true,currentIndex:0};for(k in j){this.options[k]=j[k]}this.wrapper.style.overflow="hidden";this.wrapper.style.position="relative";this.masterPages=[];n=document.createElement("div");n.id="swipeview-slider";n.style.cssText="position:relative;top:0;height:100%;width:100%;-webkit-transition-duration:0;-webkit-transform:translate3d(0,0,0);-webkit-transition-timining-function:ease-out";this.wrapper.appendChild(n);this.slider=n;this.refreshSize();for(k=-1;k<2;k++){n=document.createElement("div");n.id="swipeview-masterpage-"+(k+1);n.style.cssText="-webkit-transform:translateZ(0);position:absolute;top:0;height:100%;width:100%;left:"+k*100+"%";if(!n.dataset){n.dataset={}}h=k==-1?this.options.numberOfPages-1:k;n.dataset.pageIndex=h;n.dataset.upcomingPageIndex=h;if(!this.options.loop&&k==-1){n.style.visibility="hidden"}this.slider.appendChild(n);this.masterPages.push(n)}l=this.masterPages[1].className;this.masterPages[1].className=!l?"swipeview-active":l+" swipeview-active";window.addEventListener(d,this,false);this.wrapper.addEventListener(a,this,false);this.wrapper.addEventListener(f,this,false);this.wrapper.addEventListener(g,this,false);this.slider.addEventListener("webkitTransitionEnd",this,false)};c.prototype={currentMasterPage:1,x:0,page:0,pageIndex:0,customEvents:[],onFlip:function(h){this.wrapper.addEventListener("swipeview-flip",h,false);this.customEvents.push(["flip",h])},onMoveOut:function(h){this.wrapper.addEventListener("swipeview-moveout",h,false);this.customEvents.push(["moveout",h])},onMoveIn:function(h){this.wrapper.addEventListener("swipeview-movein",h,false);this.customEvents.push(["movein",h])},onTouchStart:function(h){this.wrapper.addEventListener("swipeview-touchstart",h,false);this.customEvents.push(["touchstart",h])},destroy:function(){var j,h;for(j=0,h=this.customEvents.length;j<h;j++){this.wrapper.removeEventListener("swipeview-"+this.customEvents[j][0],this.customEvents[j][1],false)}this.customEvents=[];window.removeEventListener(d,this,false);this.wrapper.removeEventListener(a,this,false);this.wrapper.removeEventListener(f,this,false);this.wrapper.removeEventListener(g,this,false);this.slider.removeEventListener("webkitTransitionEnd",this,false)},refreshSize:function(){this.wrapperWidth=this.wrapper.clientWidth;this.wrapperHeight=this.wrapper.clientHeight;this.pageWidth=this.wrapperWidth;this.maxX=-this.options.numberOfPages*this.pageWidth+this.wrapperWidth;this.snapThreshold=this.options.snapThreshold===null?Math.round(this.pageWidth*0.15):/%/.test(this.options.snapThreshold)?Math.round(this.pageWidth*this.options.snapThreshold.replace("%","")/100):this.options.snapThreshold},updatePageCount:function(h){this.options.numberOfPages=h;this.maxX=-this.options.numberOfPages*this.pageWidth+this.wrapperWidth},goToPage:function(j){var h;this.masterPages[this.currentMasterPage].className=this.masterPages[this.currentMasterPage].className.replace(/(^|\s)swipeview-active(\s|$)/,"");for(h=0;h<3;h++){className=this.masterPages[h].className;/(^|\s)swipeview-loading(\s|$)/.test(className)||(this.masterPages[h].className=!className?"swipeview-loading":className+" swipeview-loading")}j=j<0?0:j>this.options.numberOfPages-1?this.options.numberOfPages-1:j;this.page=j;this.pageIndex=j;this.slider.style.webkitTransitionDuration="0";this.__pos(-j*this.pageWidth);this.currentMasterPage=(this.page+1)-Math.floor((this.page+1)/3)*3;this.masterPages[this.currentMasterPage].className=this.masterPages[this.currentMasterPage].className+" swipeview-active";if(this.currentMasterPage==0){this.masterPages[2].style.left=this.page*100-100+"%";this.masterPages[0].style.left=this.page*100+"%";this.masterPages[1].style.left=this.page*100+100+"%";this.masterPages[2].dataset.upcomingPageIndex=this.page==0?this.options.numberOfPages-1:this.page-1;this.masterPages[0].dataset.upcomingPageIndex=this.page;this.masterPages[1].dataset.upcomingPageIndex=this.page==this.options.numberOfPages-1?0:this.page+1}else{if(this.currentMasterPage==1){this.masterPages[0].style.left=this.page*100-100+"%";this.masterPages[1].style.left=this.page*100+"%";this.masterPages[2].style.left=this.page*100+100+"%";this.masterPages[0].dataset.upcomingPageIndex=this.page==0?this.options.numberOfPages-1:this.page-1;this.masterPages[1].dataset.upcomingPageIndex=this.page;this.masterPages[2].dataset.upcomingPageIndex=this.page==this.options.numberOfPages-1?0:this.page+1}else{this.masterPages[1].style.left=this.page*100-100+"%";this.masterPages[2].style.left=this.page*100+"%";this.masterPages[0].style.left=this.page*100+100+"%";this.masterPages[1].dataset.upcomingPageIndex=this.page==0?this.options.numberOfPages-1:this.page-1;this.masterPages[2].dataset.upcomingPageIndex=this.page;this.masterPages[0].dataset.upcomingPageIndex=this.page==this.options.numberOfPages-1?0:this.page+1}}this.__flip()},next:function(){if(!this.options.loop&&this.x==this.maxX){return}this.directionX=-1;this.x-=1;this.__checkPosition()},prev:function(){if(!this.options.loop&&this.x==0){return}this.directionX=1;this.x+=1;this.__checkPosition()},handleEvent:function(h){switch(h.type){case a:this.__start(h);break;case f:this.__move(h);break;case b:case g:this.__end(h);break;case d:this.__resize();break;case"webkitTransitionEnd":if(h.target==this.slider&&!this.options.hastyPageFlip){this.__flip()}break}},__pos:function(h){this.x=h;this.slider.style.webkitTransform="translate3d("+h+"px,0,0)"},__resize:function(){this.refreshSize();this.slider.style.webkitTransitionDuration="0";this.__pos(-this.page*this.pageWidth)},__start:function(i){if(this.initiated){return}var h=e?i.touches[0]:i;this.initiated=true;this.moved=false;this.thresholdExceeded=false;this.startX=h.pageX;this.startY=h.pageY;this.pointX=h.pageX;this.pointY=h.pageY;this.stepsX=0;this.stepsY=0;this.directionX=0;this.directionLocked=false;this.slider.style.webkitTransitionDuration="0";this.__event("touchstart")},__move:function(k){if(!this.initiated){return}var i=e?k.touches[0]:k,j=i.pageX-this.pointX,h=i.pageY-this.pointY,m=this.x+j,l=Math.abs(i.pageX-this.startX);this.moved=true;this.pointX=i.pageX;this.pointY=i.pageY;this.directionX=j>0?1:j<0?-1:0;this.stepsX+=Math.abs(j);this.stepsY+=Math.abs(h);if(this.stepsX<10&&this.stepsY<10){return}if(!this.directionLocked&&this.stepsY>this.stepsX){this.initiated=false;return}k.preventDefault();this.directionLocked=true;if(!this.options.loop&&(m>0||m<this.maxX)){m=this.x+(j/2)}if(!this.thresholdExceeded&&l>=this.snapThreshold){this.thresholdExceeded=true;this.__event("moveout")}else{if(this.thresholdExceeded&&l<this.snapThreshold){this.thresholdExceeded=false;this.__event("movein")}}this.__pos(m)},__end:function(i){if(!this.initiated){return}var h=e?i.changedTouches[0]:i,j=Math.abs(h.pageX-this.startX);this.initiated=false;if(!this.moved){return}if(!this.options.loop&&(this.x>0||this.x<this.maxX)){j=0;this.__event("movein")}if(j<this.snapThreshold){this.slider.style.webkitTransitionDuration="300ms";this.__pos(-this.page*this.pageWidth);return}this.__checkPosition()},__checkPosition:function(){var j,h,i;this.masterPages[this.currentMasterPage].className=this.masterPages[this.currentMasterPage].className.replace(/(^|\s)swipeview-active(\s|$)/,"");if(this.directionX>0){this.page=-Math.ceil(this.x/this.pageWidth);this.currentMasterPage=(this.page+1)-Math.floor((this.page+1)/3)*3;this.pageIndex=this.pageIndex==0?this.options.numberOfPages-1:this.pageIndex-1;j=this.currentMasterPage-1;j=j<0?2:j;this.masterPages[j].style.left=this.page*100-100+"%";h=this.page-1}else{this.page=-Math.floor(this.x/this.pageWidth);this.currentMasterPage=(this.page+1)-Math.floor((this.page+1)/3)*3;this.pageIndex=this.pageIndex==this.options.numberOfPages-1?0:this.pageIndex+1;j=this.currentMasterPage+1;j=j>2?0:j;this.masterPages[j].style.left=this.page*100+100+"%";h=this.page+1}i=this.masterPages[this.currentMasterPage].className;/(^|\s)swipeview-active(\s|$)/.test(i)||(this.masterPages[this.currentMasterPage].className=!i?"swipeview-active":i+" swipeview-active");i=this.masterPages[j].className;/(^|\s)swipeview-loading(\s|$)/.test(i)||(this.masterPages[j].className=!i?"swipeview-loading":i+" swipeview-loading");h=h-Math.floor(h/this.options.numberOfPages)*this.options.numberOfPages;this.masterPages[j].dataset.upcomingPageIndex=h;this.slider.style.webkitTransitionDuration="300ms";newX=-this.page*this.pageWidth;if(!this.options.loop){this.masterPages[j].style.visibility=newX==0||newX==this.maxX?"hidden":""}if(this.x==newX){this.__flip()}else{this.__pos(newX);if(this.options.hastyPageFlip){this.__flip()}}},__flip:function(){this.__event("flip");for(var h=0;h<3;h++){this.masterPages[h].className=this.masterPages[h].className.replace(/(^|\s)swipeview-loading(\s|$)/,"");this.masterPages[h].dataset.pageIndex=this.masterPages[h].dataset.upcomingPageIndex}},__event:function(h){var i=document.createEvent("Event");i.initEvent("swipeview-"+h,true,true);this.wrapper.dispatchEvent(i)}};return c})();